% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[11pt,hyperref]{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margin=2in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options

% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{amsmath} % for much better looking tables
\usepackage{xspace}
\usepackage{url}
\usepackage{soul}
\usepackage{xcolor}
\usepackage{amssymb} % for much better looking tables
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{ntheorem} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
\usepackage{framed}
% These packages are all incorporated in the memoir class to one degree or another...

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!

\newcommand{\Answer}[1]{\noindent{\color{gray!55!black}\textsf{\ul{Response:} }{\sf#1}}}
\newcommand{\Comment}[1]{\item{\textsf{\ul{Comment:} }{\it#1}}}
\newcommand{\AnswerTODO}[2][All]{\noindent{\color{blue!80!black}\textsf{\ul{TODO Respond (#1):} }{\sf#2}}}

%%% END Article customizations


%%% The "real" document content comes below...


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors here                   %%
%%                                          %%
%% Specify information, if available,       %%
%% in the form:                             %%
%%   <key>={<id1>,<id2>}                    %%
%%   <key>=                                 %%
%% Comment or delete the keys which are     %%
%% not used. Repeat \author command as much %%
%% as required.                             %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\title{Response to reviewers\\[.3em]Fixed-Parameter Tractable Sampling for RNA Design with Multiple Target Structures}
\author{
Stefan Hammer \and Wei Wang \and Sebastian Will \and Yann Ponty}

\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 

\begin{document}
\maketitle

First of all, the authors wish to express their gratitude to the reviewers for their encouraging comments and constructive criticisms. We tried to address these points to the best of our abilities in this revised version of the manuscript.
\section{General response}

\section{Detailed responses}

\subsection{Reviewer \#1}
\begin{enumerate}
\Comment{While this manuscript exhaustively described the algorithms of RNARedPrint and its advancement from theoretical aspects, it would be hard for BMC bioinformatics readers to understand what are the sophisticated points applied in RNARedPrint for a practical use.
Related to that problem, it is also not clear what methods (or what options or approximations) are applied for each comparison in the results.
Thus, this manuscript is considered to be further improved in terms of intelligibility of the methods and results using fair evaluation criteria.\\[1em]}%
\AnswerTODO[Yann]{...}
\Comment{For evaluation of a method to design RNA molecules, the number of the solutions it produces and its running time are considered to be important.\\[1em]}%
\Answer{Indeed, this is a relevant parameter to ensure a fair comparison. We note, however, that one must distinguish the number of sequences produced as the final output of our method from the total number of sequences generated by our rejection sampling strategy, the large majority of which are discarded for not satisfying certain properties. While this may appear wasteful, this probabilistic approach saves very substantial amount of time (and memory) compared to natural alternatives (classified dynamic programming, or constraint-based systems), at the price of some rejections, expected to remain reasonable from general analytic combinatorics principles.}
\Comment{
In the scope of this study, the running time and memory comparison should be shown to produce the same number of sequences by some minor variants of RNARedPrint method, RNABluePrint, and MODENA.\\[1em]}%%
\AnswerTODO[Stefan]{
We did not fully understand this remark, and interpreted it to mean that a fair comparison should dedicate equal amount of runtime to each of the compared method. 
(Stefan, is that the case?)
In the revised version, we reported the runtime required by all those approaches in the setting of the benchmark.
}
\Comment{
It would be informative if the authors show the number of rejected sequences produced by RNARedPrint considering the specific criteria (GC\% or free energy). 
Since RNARedPrint keeps the sequences to be under the specific constraint by a simple rejection method, such information for various target conditions would be better to estimate the practical running time of RNARedPrint.\\[1em]}%
\AnswerTODO[Sebastian]{
We now report the frequency of rejections measured under various conditions. (Further comments...)
}
\Comment{
Another is the quality of their solutions in terms of the stability of each target structure.\\[1em]}%
\AnswerTODO[Seb+Stefan]{ Can we report that? If so, why not...
}
\Comment{
According to their results, adaptive sampling has a strong power to improve the results. Unfortunately, the authors only introduce the existence of weights first in the first section of methods.
It would be better that the authors introduce the concept of weights at the beginning (and whether they are completely same with those in RNAblueprint or not).\\[1em]}%
\AnswerTODO[Yann]{
Weights are used for two different purposes:
\begin{itemize}
    \item In order to induce a Boltzmann distribution on the set of sequences;
    \item As a technical artifact, to ensure the efficiency of a rejection-based strategy to control auxiliary features (free-energies for structures, GC\%\ldots)
\end{itemize}
}
\Comment{
Moreover, it is not well described how we can choose the initial weights and what values they are converged in the actual cases (e.g., Fig2 and S4) after adaptive sampling.\\[1em]}%
\AnswerTODO[Stefan]{
The calibration of weights relies on a numerical iteration aiming at computing weights such that expected properties of sampled sequences (which depend on weights) match their targeted values. Associated problems are usually convex, and we describe in supplementary material a numerical iteration to compute suitable weights.
We also added to Fig 2 and 4 the final weights.
}
\Comment{
The influence of long loops and stacking should be measured for the sequences having different GC contents and length. Moreover, the number of base pairs in target structures should be considered since such approximation might be critical when the long loops appear in the target structures.
\\[1em]}%
\AnswerTODO[Yann]{Our approximation only hold for a single structure. Long loops tend to be oblivious of their content so, while approximating the energy model for long loops would be a problem in the context of structure prediction, they are not in the context of design. (to be clarified/elaborated)

}
\Comment{
$R^2$ values and $p$-values are also necessary to evaluate the correlation between two energy models. (What are the lines in Fig2A representing?)
\\[1em]}%
\AnswerTODO[Stefan+Sebastian]{
Compute $R^2$ (detaching plot). Write paragraph about goodness of fit
}
\Comment{
Through the analyses, the names of energy models should be specified more clearly. The original model, simplified base paired model, and stacking model are confusing. Remove base-paired (simplified Turner).
\\[1em]}%
\AnswerTODO[Yann]{
To avoid any confusion, we moved the paragraph describing the integration of various energy models to the appendix. We now only describe our simplified stacking model, which we more explicitly show to be highly correlated with the Turner energy model.
}
\Comment{
Multi defect can be a good measure to understand the overall performance of the sequence designing method, but there is little explanation why Multidefect is enough to evaluate the quality of sequences for the multi (target-structure) objective problem in a practical use case such as Riboswitch design.
\\[1em]}%
\AnswerTODO[Yann]{Not really our job, but we can maybe remind some of the key arguments.
}
\Comment{
Although RNABluePrint was compared with MODENA in the previous study, RNABluePrint did not overwhelm MODENA in all of conditions (and it is unclear which version (variant) of RNABluePrint is applied in this study).
For that reason, RNARedPrint still should be compared with MODENA (in the same running time) using Multidefect and the criteria used in the previous studies such as $\delta$e1 and $\delta$e2. Also, RNARedprint and RNABlueprint are optimised to increase only a Multidefect value.\\[1em]}%
\AnswerTODO[Stefan]{First of all, it is perhaps worth reminding that RNAredprint is not intended as a tool for negative design, but rather a good seed generation algorithm, amenable to further optimization using other tools. For this reason, we focused our validation on this potential for better initialization, and compared the quality of sequences generated by RNAredprint (Boltzmann weighted) to RNAblueprint (uniform). We noticed that, while RNAredprint is not explicitly tailored to optimize MultiDefect, it nevertheless produces sequences that: 1) achieve better values; and 2) are amenable to better further optimizations than the uniform version implemented by RNABluePrint.
}

\Comment{
Hence, the distribution of Multidefect, previous criteria, and the first and second term of Multidefect should be shown in box plots or violin plots to know the robustness of RNARedPrint It is also interesting what is the characteristic of the sequence designed by each method in a specific example of functional RNA molecules. \\[1em]}%
\AnswerTODO[Yann]{Again, we do not adhere to such a benchmark-driven view of design tasks. The time of design is generally negligible compared to the time taken to experimentally assess the ultimate functionality of a design. What we believe to matter more to the community is the expressivity of the tools, allowing to address various use-cases.
}
\Comment{(Is RNARedPrint able to produce, for example, the combination of two long stem loops which are high and low GC-content, respectively?)\\[1em]}%
\AnswerTODO[Yann]{In the current implementation, it is only possible to constrain the global GC\% of the sequence. It is however possible to support this feature within our general framework, since one can associated individual objectives to structures (eg  structures are already associated with individual target energies). Different stems can be expressed as different structures by "peeling the structure", so this feature could be added to a future version, should the concrete need arise.
}
\Comment{
The section "problem statement" is not helpful enough for readers, both of algorithmic and biological people.\\[1em]}%
\AnswerTODO[Yann]{We attempted to clarify it.
}
\Comment{
In particular, it is difficult to comprehend the relationships between the variables due to insufficient descriptions and lack of definitions.
For example, they do not specify any relationship between R and F in this section while they should not be independent. (e.g., m should be equal or less than k?)
Moreover, I cannot find a definition of several variables. (e.g., What is $S$, $S_i$, $x$, $xp$, $xd$, $vp$, $bu{chi}$ (P9L24) ? Where "its dependence dep $f$" comes from?)
Because this manuscript contains many variables and abbreviations, it is recommended to have a table or image to explain the variables and their actual examples following the sampling example in Fig1. The description of the brief aim and summary of each step would be a good guide for readers.\\[1em]}%
\AnswerTODO[Yan]{
Add method overview
}
\Comment{
* Ensemble free energy: might be an ambiguous definition\\[1em]}%
\Answer{The concept of ensemble free-energy is a well-defined concept in statistical mechanics, and is used here in a way that, to the best of our knowledge, matches its usual definition.}
\Comment{
* While $\chi$ is a subset of nodes $X$, is a subset of $\chi$ an edge? (P7 L19)\\[1em]}%
\AnswerTODO{
??
}
\Comment[Sebastian :)]{
* Is the output of algorithm 2 only one sequence? It is unclear when two (or more?) sequences are merged by $S \cup S'$.\\[1em]}%
\AnswerTODO{???
}
\Comment{
Is it correct no break at P10L23?\\[1em]}%
\AnswerTODO{
??
}
\Comment{
* In Fig2, the notation like $(a, b)$ is confusing with the range (of free energies or something).\\[1em]}%
\AnswerTODO{
}
\Comment{
* Unfortunately, I could not run RNARedPrint (while it can be just compiled when I make bin directory). More detailed documentation is required such as OS dependency or the version information the authors confirmed.\\[1em]}%
\AnswerTODO[Yanns]{
Yann will check
}
\Comment{
* It seems not trivial that Boltzmann sampling works better to control GC contents, but the stability of structures. What's the reason the authors include GC contents for the criteria of Boltzmann-weighted sampling?\\[1em]}%
\Answer{GC\%, just like the free-energy of any given target structure, can be expressed uniformly in our framework in a way that is additive on base pairs. Control over GC\% has recurrently been identified as critical, since a good stability usually implies high GC\%, yet actual sequences usually combine good stability with reasonable GC\%. Modern computational objectives of design are to ensure good stability (+specificity) while producing sequences of prescribed GC\%\\[1em]}%
\AnswerTODO{
}
\Comment{
* The order of authors is different between the main manuscript and supplementary (not sure whether they used just an alphabetical order).\\[1em]}%
\AnswerTODO{
?
}
\Comment{
* Is the section "\# P-hardness of counting valid designs" necessary in the main script (not supplementary) to explain the results? The complexity of the problem is important to consider theoretical limitations, but the assumption in that section seems not to be necessary since the authors applied a greedy sampling strategy and not in the scope of this study.\\[1em]}%
\Answer{we respectfully disagree with that assessment.
The core of our approach consists in generating, uniformly at random (resp. in a Boltzmann distribution, which identifies with the uniform distribution when $T\to +\infty$). Such a generation algorithm usually starts by precomputing some numbers of solutions (here, sequences that satisfy the classic base pairing rules) later to be used to ensure the uniformity of the generation through stochastic choices. The precomputation step  requires an efficient algorithm for counting the number of solutions. In this work, we provide an {\bfseries exact} algorithm (not a heuristics) for the problem which, while being FPT, still requires exponential time when the tree-width increases with the sequence length. This raises the natural question: Can a truly polynomial algorithm exist for the problem? Our proof of \#P-hardness provides a negative answer to this problem under fairly reasonable assumptions. We tried to clarify those points in our introduction of the \#P hardness result.
}
\Comment{
* Move the first section in the result to the method.\\[1em]}%
\AnswerTODO[Yann]{
Ok (but include efficiency of multidim sampling, keeping correlation analysis)
}
\end{enumerate}
\subsection{Reviewer \#2}
\begin{enumerate}
\Comment{
1) The "Methods" section is very long, it should be shortened.\\[1em]}%
\AnswerTODO[Yann]{
Well, some methods require longer descriptions ;)
Move expression of various energy models as constraints Turner to appendix
Move numerical weight optim to appendix
Better motivations for \#P-hardness
New results : 
  1) Validation of stacking approximation: Correlation coefficient of Stacking and Turner (+ goodness of fit)
  2) Rejection analysis for multidim sampling
  3) Tree width and Time benchmark
  5) Proof-of-concept -Potential of better seeds
}
\Comment{
2) Although, it was shown previously, that RNABluePrint is a leading tool for multiple design, it would be valuable to include and compare the results generated by the other tools, e.g. Frnakenstein.\\[1em]}%
\AnswerTODO[Stefan+Sebastian]{
The three currently available tools are Frnakenstein, RNABluePrint and Modena. Shall we do that?
}
\Comment{
3) Please include computational times of the performed designs with the given benchmark.\\[1em]}%
\AnswerTODO[Stefan]{
Will do
}
\Comment{
4) The paper should be checked for English grammar and wording.\\[1em]}%
\AnswerTODO{
Will do
}
\end{enumerate}
\subsection{Reviewer \#3}
\begin{enumerate}
\Comment{
In Figure 3 of Supplementary Material: more detailed description for explaining the two examples of tree decomposition is appreciated, particularly for the readers who are not familiar with tree decomposition; e.g. why these two examples are output, and the other examples for RF3 exist or not?\\[1em]}%
\AnswerTODO[Sebastian]{
Discussion
}
\Comment{
In "L Detailed result of MultiDefect Analysis" of Supplementary Material, running time is missing. Since the Boltzmann sampling in RNARedPrint utilizes the rejection approach, I would like to know the difference between the running times of the Boltzmann sampling and the uniform sampling. \\[1em]}%
\AnswerTODO[Yann]{ Added runtimes.
None, but for multidim sampling, rejection and weight optimization stack up (we report them).
}
\Comment{
In addition, I think it is better that the N/A result is indicated not by a blank but by a "N/A" in the table.\\[1em]}%
\AnswerTODO[Stefan/Sebastian]{
Will add results times}
\end{enumerate}
%\bibliographystyle{amsplain}
%\bibliography{response}
\end{document}
